\chapter{Conclusion and perspectives}
\label{chap11}


\section{Summary of contributions}

The objective of this PhD was to propose soft tissue models for computing the deformation of anatomical structures in real-time. Because the shape and the internal nature of these structures greatly differ, a unique model cannot deal with the variousness of the mechanical behaviours. Hence, we identified two major types of structures in human body, they can be either solid (brain, liver, prostate etc.) or hollow (colon, blood vessels, stomach etc.). 

Most of previous works focus on volumetric models that are able to capture the behaviour of solid organs. Yet, many of these models had to compromise on accuracy to achieve the real-time constraint demanded by medical simulation. Even though the best mathematical framework for predicting the deformation of a continuous structure is provided by continuum mechanics, solving these equations is a computationally very demanding task and simpler models are often used in practice. And even when the finite element method is employed to solve the equations of continuum mechanics, linear strain measure and simple constitutive laws are common and therefore does not constitute an appropriate modelling of the complex mechanical behaviours of solid anatomical structures. 

In contrast, much less research has been carried out for the modelling of hollow structures. In fact in the field of medical simulation, very few models have been proposed for simulating, in real-time, the deformation of thin anatomical structures whose volume is negligible compared to their surface area. Nevertheless, human body features many hollow structures and we feel that the need for modelling hollow organs in medical simulation is equally important as with solid organs. 

\bigskip

Consequently, we strived to propose solutions to these two known problems in the field of medical simulation.

\subsubsection*{Solid structure modelling.}
We implemented the total Lagrangian explicit dynamics (TLED) algorithm on GPU using CUDA. This finite element formulation is fully non-linear: it makes use of a non-linear strain measure (which allows large deformations) and embodies a non-linear constitutive law between strain and stress as characterised by \cite{Fung93} for soft-tissues. While the first GPU implementation of the TLED was carried out by \cite{Taylor07b} in the Cg language, our efficient re-implementation in CUDA led to a threefold increase in performance. Overall, we observe a maximum speed improvement for GPU solution over CPU solution of up to $56.3 \times$. My collaboration with Zeike Taylor continued and we enhanced the formulation by adding anisotropy and viscoelasticity. To the best of our knowledge, this work constitutes the first GPU implementation of a non-linear, anisotropic and viscoelastic finite element procedure. This formulation was eventually implemented in the open source framework for medical simulation SOFA and will be released publically with the upcoming 1.0 release of SOFA. 
%By providing a fast and accurate non-linear FEM with various constitutive laws for soft tissue modelling to worldwide researchers, we thus hope to assist in enhancing the realism of medical simulators. 

\subsubsection*{Hollow structure modelling.}
We proposed a framework for real-time modelling of thin anatomical structures. We first designed a triangular shell element by combining a two-dimensional in-plane membrane energy, with an off-plane energy for describing bending and twist. We improved and extended a plate model first introduced by \cite{Przemieniecki85} to a co-rotational formulation to allow large displacements (but small deformations). Once combined with an in-plane membrane formulation we obtained an accurate, yet computationally efficient, shell finite element method featuring both membrane and bending energies. To the best of our knowledge, this co-rotational shell FEM is the first description of a shell finite element method in the field of medical simulation. However, to model the deformation of complex anatomical structures using shell elements, the first step is to describe its surface with curved patches. Indeed, while many flat triangles are required to describe highly curved surfaces, fewer triangular shell elements are needed to describe a given geometry with the same precision since they can be curved. Therefore, we suggested a simple method to mesh a surface with curved shell elements. The novelty of our method relies on the combination of a shell finite element formulation and a geometric surface reconstruction both based on the same polynomial interpolation function used to describe the surface of shells. We also showed how contacts and interactions with the curved surfaces of shells can be detected and handled using the same function. 


\section{Discussion}

	\subsection{Solid structures modelling}

The TLED algorithm offers an accurate modelling for soft tissues and its GPU implementation using CUDA is very fast. Hence, real-time computations can be achieved without any trade-off on the accuracy of the deformation. One of the features allowing such an efficiency is the use of an explicit time integration scheme. If this permits significant computational advantage, the use of an explicit integration scheme imposes that the time step of the simulation remains below a critical time step. This critical time step depends on two kinds of criteria: the size of the elements and the material's properties (Young's modulus and Poisson's ratio). Therefore, the meshing of the anatomical structures to be simulated must be accomplished with great care to insure well-shaped elements. Even more restricting, the use of the TLED formulation is not suitable for modelling stiff objects in real-time. Indeed, increasing the Young's modulus translates into a lower critical time step, which necessitates an intensification of the simulation's frequency to enforce real-time. In some applications, the value of the Poisson's ratio may be relaxed from 0.49 to 0.45 for instance. However, if it allows to double the critical time step, this relaxation introduces additional inaccuracies. 

One of the most common critics we received for this work concerned the poor ability of the TLED to handle interaction between organs and virtual tools. Indeed, interactions may impact the critical time step resulting from the use of an explicit time integration scheme and thus influence the overall stability of the simulation. The work carried out during my PhD was entirely concerned with the numerical solution provided by the TLED formulation. Yet, while this is beyond the scope of the present work, a range of contact formulations are available in commercial finite element packages. According to their documentation, the impact on the critical time step should be minimal. However, for a demonstration at an IT exhibition (CeBIT Australia), we tried to setup an interaction between a virtual tool driven by a haptic device and a cube with brain-like properties. If we managed to produce an interesting demo for the exhibition, its preparation brought out an unstable system. But even if a stable contact modelling technique could be formulated, the actual limiting factor is the collision detection process. Because the time step must be very small when using an explicit time integration scheme (often around one millisecond or less), the collision detection algorithm must also be run at the same frequency. The problem is that no collision detection algorithm is fast enough to execute at $ 1\,000\,$Hz or more with objects of reasonable sizes. One notable exception is the interaction with a fixed rigid surface where the collision detection is rapid. 

Consequently, this list of pros and cons limits the TLED's range of applications. If its usage in very interactive environments is not suitable, the TLED finite element algorithm is great at computing the deformation of soft tissues when the boundary conditions are known and controlled. Hence, provided that the application is appropriate, the TLED algorithm is an efficient and accurate algorithm to model the deformation of solid soft anatomical organs. 

	\subsection{Hollow structures modelling}
	
We achieved our objectives to propose a versatile solution which can simulate, in real-time, thin objects with various shapes and material properties with good accuracy. The efficiency of the method was illustrated through shell-based reconstruction and real-time simulation of the deformations of various anatomical structures and other thin objects. Nevertheless, the use of a linear strain measure limits the range of application to small deformations only. Moreover, the constitutive law was chosen to be the simple (linear) Hookean law, which it is known not to describe accurately the relationship between strain and stress in soft tissues. However, those potential changes are substantial and their implementations are not straightforward. In addition, it is not clear from which method the benefits would be the greatest: whether from enhancing our model to a non-linear formulation or completely changing to another model based on true mathematical shell theory (where membrane and bending energies are not separated). Our shell FEM could also be improved by implementing the formulation on GPU. Although an optimal parallel implementation is always challenging, our method is highly parallelisable and there is no major obstacle to an efficient GPU implementation.

Regarding our geometric surface reconstruction based on shells, we were able to mesh complex anatomical structures with a fairly small number of shell elements. However, the main drawback of our method is the lack of any assessment of the quality of the elements created. Indeed, if some elements are stretched from the heavy decimation, these elements are not corrected during the process of re-meshing. Our algorithm could even worsen the situation by splitting those stretched elements into four smaller (and more stretched) elements. Yet, meshing a surface with curved elements is a very challenging problem and still an active area of research. In contrast to all geometrical techniques described in the literature, we presented a more physical approach consistent with our shell FEM formulation and obtained good results in meshing complex anatomical structures. 

	
	\subsection{Use of GPU acceleration}	
	
One of the strongest constraint in medical simulation is the demand for real-time computations. This constraint is what makes all tasks in a simulator so challenging (collision detection, contact and soft tissue modelling, haptic feedback, photo-realistic rendering etc.). In fact, this is at the origin of the multitude of simplifications proposed in simulation for modelling the biomechanics of anatomical structures. The lack of accuracy induced by these simplifications is of great concern to us. In this PhD, a part ot the solution was to accelerate the computations by using the GPU. While we have showed that this approach can work very well, we need to keep in mind that GPU acceleration is not the panacea. Firstly, a standard is yet to be imposed in GPGPU. While OpenCL is openly targeted as a multi-vendor and multi-platform API, its usage remains very scarce nevertheless. In fact, the first experiments carried out within the SOFA framework revealed that OpenCL is not as optimised as CUDA for instance (up to twice as slow). Secondly, GPU programming is not simple to master. Although we have seen many improvements in flexibility of programming over the last 3 or 4 years, a strong understanding of the underlying GPU hardware is still mandatory to create an optimal code. As an example, a GPU offers different types of memory, all with distinct pros and cons (strict access patterns, latency, limited size etc.), and choosing the best type of memory for each variable may be rather challenging to say the least. But most importantly, GPU acceleration is only interesting if the code is highly parallelisable. The difficulty is to devise a model that combines (1) an excellent capability at predicting the deformation of anatomical structures and (2) great parallel properties. Ideally, the parallelisation of the algorithm must be thought as part of the design process rather than seen as two unconnected steps. Even when the code is greatly parallelisable, one could face limited GPU hardware possibilities (as with concurrent writes for instance). 

GPU acceleration is all but a straightforward process. One must often accomplish a considerable amount of work to achieve a substantial gain. However, a decent GPU implementation may allow improvements of up to one or two orders of magnitude. For instance, our CUDA implementation of the TLED algorithm was about $ 56 \times $ faster than an equivalent CPU implementation on 2008 hardware. 
	

\section{Perspectives}

Earlier this year, NVIDIA released a new GPU architecture called \emph{Fermi}. Fermi features several major innovations for GPGPU computing like cache (faster memory access in some cases), unified address space (easier to run C and C++ programs), debugging support, faster atomic instructions, compliance with the newly revised IEEE 754 floating point standard, three times the amount of shared memory, etc. In theory, this series of improvement should boost the performance of the second and third TLED implementations (see section \ref{chap6:secondTLED}) and we should investigate and compare the efficiency of the three designs on this new hardware. 

In a short term perspective, our co-rotational shell FEM algorithm could also be implemented on GPU. We already assessed in section \ref{chap9:GPU} that there was no major obstacle which would prevent a parallel implementation. Nevertheless, an optimal GPU implementation will demand careful design to take full advantage of the hardware. 

Although the meshing of complex surfaces with curved shell elements was not the heart of this PhD, our naïve approach could be enhanced by focusing on element quality. One simple solution would be to add a relaxation phase where a repulsion force is applied between each vertex (constrained to remain on the surface of the object). This physical approach would allow a more even distribution of the vertices across the surface and would contribute to obtain better quality elements overall. While a more mathematical method (a derivative of advancing front techniques for instance) could probably be formulated, the problem is complex and could certainly account for another PhD. 

Finally, all the contributions of this PhD could contribute to enhance the complexity of anatomical structure modelling through combining solid and hollow structures. While we presented our findings on the coupling between solid (tetrahedra) and thin objects (shells) via the simulation of an angioplasty procedure, these results are still preliminary and much work remains to be done. In particular, the validity of the interaction and the accuracy of the overall deformation of the blood vessel were not quantitatively evaluated. 

As a conclusion, the TLED algorithm and our co-rotational shell FEM are respectively the first non-linear FEM for solid structures and the first model featuring bending for hollow structures to be implemented into the open source framework SOFA. Although they are based on continuum mechanics, they may both be employed to simulate the deformation of entire organs in real-time. By providing efficient FEM algorithms for all types of anatomical structures to worldwide researchers, we thus hope to assist in enhancing the realism of medical simulators.
